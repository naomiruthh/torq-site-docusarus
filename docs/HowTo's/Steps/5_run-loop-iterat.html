<!-- ## Metadata_Start
## title: Run loop iterations in parallel
## original-url : https://learn.torq.io/docs/run-loop-iterations-in-parallel
## article-id : f980a17b-117d-4c43-bcf1-95f19e97b08b
## seo-title : Run loop iterations in parallel in Torq automated security workflows
## description : When loop iterations are not dependent on one another, run the loop in Parallel mode, which speeds up loop execution time in automated security workflows.
## category-type : html
## Metadata_End -->
<p>By default, loop iterations are executed sequentially. This means an iteration on an item runs to completion before another starts.&nbsp;</p><p>When loop iterations are not dependent on one another, running the loop in Parallel mode is a good idea. Running loops in parallel significantly speeds up loop execution time.</p><h2>When to use parallel mode</h2><p>Loops in parallel mode run faster and more efficiently. Here are two common use cases for running loops in parallel.</p><ul><li>Query multiple threat intel vendors and process the queries simultaneously</li><li>Send question messages to multiple users while investigating an incident and process the input simultaneously</li></ul><h3>Important notes</h3><ul><li>Running a loop in <strong>Parallel</strong> mode will result in simultaneous calls to the same vendor (from the steps in the body of the loop). This means the vendor's rate limit might be reached and cause steps to fail. Check the vendor's documentation for rate limits and implement a retry mechanism to work around this situation.</li><li>If there's a loop that will do more than 50 iterations at once, it will split into batches of 50 iterations at a time (ex: 100 iterations splits into two batches of 50, 80 interactions splits into a batch of 50 and a batch of 30). This will not impact the speed the steps are run. </li><li>Having a loop inside of a parallel loop will multiply the number of iterations run, and you may hit the limit (5000) faster. If you are looping through data, use <strong>Chunk array</strong> to split the array into smaller batches and avoid hitting the limit of iterations run.&nbsp;</li><li>If a step run by a private runner inside the body of a loop fails, check the runner host's available resources and make sure they are sufficient to support the parallel loops.</li><li><strong>Exit&nbsp;</strong>and <strong>Break&nbsp;</strong>operators cannot be inside a parallel loop.&nbsp;</li></ul><h2>When to use sequential mode</h2><p>Run loops in <strong>Sequential</strong> mode when the order in which the loop iterations are executed is important. Here are a few examples:</p><ul><li>Pagination requests</li><li>Retry on failure</li><li>Escalation flow</li></ul><h2>How to use parallel mode</h2><p>The execution order of the loop iterations is unknown. In the example below, the loop input is a list of IP addresses to investigate.&nbsp;</p><p>Multiple IP queries are submitted to VirusTotal simultaneously so you can collect results as they are returned. You don't have to wait for a specific query's result before submitting the next one.</p><ol><li>Drag the <strong>Loop</strong> operator onto the designer and switch the <strong>Mode</strong> toggle to <strong>Parallel</strong>.<br><img src="https://cdn.document360.io/e159bc51-b5b1-4b1f-af39-a9db2fa968d6/Images/Documentation/parallel-loop-toggle.png" alt="In the loop operator set the mode to parallel." class="fr-dib fr-bordered" style="width: 1340px;"></li><li>Select the <strong>Type&nbsp;</strong>and define the data to loop over.<ol><li>In: the array to loop over</li><li>Range: Define the <strong>Start</strong>, <strong>End</strong>, and <strong>Step size</strong>.</li></ol></li><li>&nbsp;(Optional) Use the <strong>Collect</strong> operator to <a href="/v1/docs/collect-loop-results" rel="nofollow noopener noreferrer" target="_blank" translate="no">collect the loop results</a> into a single array.<br><img src="https://cdn.document360.io/e159bc51-b5b1-4b1f-af39-a9db2fa968d6/Images/Documentation/collect-loop-operator.png" alt="Hover over the loop operator in the steps library to reveal the collect operator." class="fr-dib fr-bordered" style="width: 1342px;"></li></ol>
